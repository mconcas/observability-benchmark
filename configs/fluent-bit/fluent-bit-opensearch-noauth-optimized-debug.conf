[SERVICE]
    Flush        2
    Daemon       Off
    Log_Level    info
    Parsers_File configs/fluent-bit/parsers.conf
    HTTP_Server  On
    HTTP_Listen  0.0.0.0
    HTTP_Port    2020
    storage.metrics on

    # Critical: Enable filesystem buffering for high throughput
    storage.path              /tmp/fluentbit-buffer/
    storage.sync              normal
    storage.checksum          off
    storage.max_chunks_up     128
    storage.backlog.mem_limit 64M

[INPUT]
    Name              syslog
    Parser            syslog-rfc5424
    Listen            0.0.0.0
    Port              5140
    Mode              unix_tcp
    Path              /tmp/fluentbit.sock
    Unix_Perm         0644

    # Increase input buffers for high-rate ingestion
    Buffer_Chunk_Size 256k
    Buffer_Max_Size   1M

    # Enable memory-backed buffering
    storage.type      filesystem

[OUTPUT]
    Name               opensearch
    Match              *
    Host               ${OPENSEARCH_HOST}
    Port               ${OPENSEARCH_PORT}
    Path               ${OPENSEARCH_PATH}
    Index              ${OPENSEARCH_INDEX}
    tls                ${OPENSEARCH_TLS}
    tls.verify         Off
    Suppress_Type_Name On
    Logstash_Format    Off

    # Bulk API optimization - increased buffer for large responses
    Buffer_Size        4M

    # Retry configuration - very high limit for reliability
    Retry_Limit        10000

    # Bulk settings for efficient batching
    Write_Operation    create
    Generate_ID        On

    # Connection pooling and GENEROUS timeouts
    # Default connect timeout is 10s â€” give 120s to survive slow bulk responses
    net.keepalive              on
    net.keepalive_idle_timeout 60
    net.connect_timeout        120
    net.source_address         0.0.0.0

    # Worker configuration for parallel uploads
    Workers            2

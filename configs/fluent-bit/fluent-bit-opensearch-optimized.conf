[SERVICE]
    Flush        2
    Daemon       Off
    Log_Level    warn
    Parsers_File configs/fluent-bit/parsers.conf
    HTTP_Server  On
    HTTP_Listen  0.0.0.0
    HTTP_Port    2020
    storage.metrics on

    # Critical: Enable filesystem buffering for high throughput
    storage.path              /tmp/fluentbit-buffer/
    storage.sync              normal
    storage.checksum          off
    storage.max_chunks_up     128
    storage.backlog.mem_limit 64M

[INPUT]
    Name              syslog
    Parser            syslog-rfc5424
    Listen            0.0.0.0
    Port              5140
    Mode              unix_tcp
    Path              /tmp/fluentbit.sock
    Unix_Perm         0644

    # Increase input buffers for high-rate ingestion
    Buffer_Chunk_Size 256k
    Buffer_Max_Size   1M

    # Enable memory-backed buffering
    storage.type      filesystem

[OUTPUT]
    Name               opensearch
    Match              *
    Host               ${OPENSEARCH_HOST}
    Port               ${OPENSEARCH_PORT}
    Path               ${OPENSEARCH_PATH}
    Index              ${OPENSEARCH_INDEX}
    HTTP_User          ${OPENSEARCH_USER}
    HTTP_Passwd        ${OPENSEARCH_PASSWORD}
    tls                ${OPENSEARCH_TLS}
    tls.verify         Off
    Suppress_Type_Name On
    Logstash_Format    Off

    # Bulk API optimization - increased buffer for large responses
    Buffer_Size        2M

    # Retry configuration - very high limit for reliability
    Retry_Limit        10000

    # Bulk settings for efficient batching
    Write_Operation    create
    Generate_ID        On

    # Connection pooling and timeouts
    net.keepalive      on
    net.keepalive_idle_timeout 30

    # Worker configuration for parallel uploads
    Workers            2
